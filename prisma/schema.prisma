generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// User
model User {
  id           String          @id //fireabse UId is the only userId
  name         String
  email        String          @unique
  phone        String?
  photoUrl     String?
  createdAt    DateTime        @default(now())
  //relationships 
  match        Match[]
  ownedPlayers PlayerProfile[]
  ownedClubs   Club[]
  claims       ClaimRequest[]

  @@map("Users")
}

enum MatchLevel {
  Professional
  semiProfessional
  academicTopTier
  academicAmateur
  sundayLeague
}

model Match {
  id           String        @id @default(uuid())
  userId       String
  videoUrl     String
  lineUpImage  String?
  // homeClubName     String
  // opponentClubName String
  status       MatchStatus   @default(PENDING)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  //relationsips
  user         User          @relation(fields: [userId], references: [id])
  matchPlayers MatchPlayer[]
  matchClubs   MatchClub[]
  result       MatchResult?  @relation("MatchAnalysisToMatchRequest")

  @@map("matches")
}

model MatchResult {
  id        String @id @default(uuid())
  matchId   String @unique
  result    Json
  match     Match  @relation("MatchAnalysisToMatchRequest", fields: [matchId], references: [id])
  //later change this based on AI output 
  homeScore Int?
  awayScore Int?

  @@map("match_results")
}

//matchPlayer - generated for match not owned profiles
model MatchPlayer {
  id              String        @id @default(uuid())
  playerProfileId String
  matchId         String
  firstName       String
  surname         String
  jerseyNumber    Int
  country         String
  level           MatchLevel
  dateOfBirth     DateTime      @db.Date
  isHomeTeam      Boolean
  position        String
  createdAt       DateTime      @default(now())
  // relation
  match           Match         @relation(fields: [matchId], references: [id])
  playerProfile   PlayerProfile @relation(fields: [playerProfileId], references: [id])

  @@map("match_players")
}

model MatchClub {
  id          String   @id @default(uuid())
  matchId     String
  clubId      String?
  name        String
  country     String
  isHomeClub  Boolean
  jerseyColor String?
  createdAt   DateTime @default(now())
  match       Match    @relation(fields: [matchId], references: [id])
  club        Club?    @relation(fields: [clubId], references: [id])

  @@map("match_clubs")
}

//
// PLAYER PROFILE (canonical identity)
//
model PlayerProfile {
  id          String      @id @default(uuid())
  firstName   String
  lastName    String
  dateOfBirth DateTime?
  country     String
  avatar      String?
  level       MatchLevel
  clubId      String //current club
  status      ClaimStatus @default(UNCLAIMED)
  ownerId     String?
  createdAt   DateTime    @default(now())

  // relations
  owner         User?          @relation(fields: [ownerId], references: [id])
  club          Club?          @relation(fields: [clubId], references: [id])
  matchPlayers  MatchPlayer[]
  claimRequests ClaimRequest[]

  // Prevent duplicate players
  @@unique([firstName, lastName, dateOfBirth, country])
  @@map("player_profiles")
}

//
// CLUB (canonical identity)
//
model Club {
  id          String      @id @default(uuid())
  name        String
  country     String
  logoUrl     String?
  status      ClaimStatus @default(UNCLAIMED)
  ownerUserId String?
  createdAt   DateTime    @default(now())

  // relations
  owner         User?           @relation(fields: [ownerUserId], references: [id])
  matchClubs    MatchClub[]
  players       PlayerProfile[]
  claimRequests ClaimRequest[]

  // Prevent duplicate clubs
  @@unique([name, country])
  @@map("clubs")
}

enum MatchStatus {
  PENDING
  PROCESSING
  COMPLETED
}

//
// CLAIM REQUEST
//
model ClaimRequest {
  id        String      @id @default(uuid())
  userId    String
  playerId  String?
  clubId    String?
  type      ClaimType
  status    ClaimStatus @default(PENDING)
  notes     String?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  user   User           @relation(fields: [userId], references: [id])
  player PlayerProfile? @relation(fields: [playerId], references: [id])
  club   Club?          @relation(fields: [clubId], references: [id])

  // Validation

  @@map("claim_requests")
}

enum ClaimStatus {
  UNCLAIMED
  PENDING
  VERIFIED
}

enum ClaimType {
  PLAYER
  CLUB
}
